<div class="min-h-screen bg-gray-50 flex flex-col">
  <!-- Header -->
  <header class="bg-white flex items-center justify-between px-6 py-4 border-b border-gray-200 shadow-sm">
    <div class="flex items-center space-x-4">
      <button 
        class="text-2xl p-2 hover:bg-gray-100 rounded-full transition-colors"
        (click)="goBack()"
      >
        â†
      </button>
      <h1 class="text-xl font-bold text-gray-900">Logros</h1>
    </div>
    <div class="flex items-center space-x-2 text-sm text-gray-600">
      <span>ğŸ†</span>
      <span>{{ gamificationState?.earned_achievements?.length || 0 }} logros</span>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-1 px-6 py-6 pb-24">
    <!-- User Progress Section -->
    <div *ngIf="gamificationState" class="bg-white rounded-xl p-6 mb-6 shadow-sm border border-gray-200">
      <div class="flex items-center justify-between mb-4">
        <div>
          <h2 class="text-xl font-bold text-gray-900">
            Â¡Hola, {{ getDisplayName() }}!
          </h2>
          <p class="text-gray-600 text-sm">Tu progreso en ActivAmigos</p>
        </div>
        <div class="text-right">
          <div class="text-2xl font-bold text-indigo-600">
            {{ gamificationState.points }}
          </div>
          <div class="text-xs text-gray-500">puntos totales</div>
        </div>
      </div>
      
      <!-- Progress Bar -->
      <app-level-progress-bar
        [level]="gamificationState.level"
        [progressToNextLevel]="gamificationState.progress_to_next_level"
        [showPoints]="true"
        [showLevel]="true">
      </app-level-progress-bar>
    </div>

    <!-- Loading State for Gamification -->
    <div *ngIf="isLoadingGamification" class="bg-white rounded-xl p-6 mb-6 shadow-sm border border-gray-200">
      <div class="animate-pulse">
        <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
        <div class="h-8 bg-gray-200 rounded w-1/2"></div>
      </div>
    </div>

    <!-- Achievements Gallery -->
    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
      <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
        ğŸ¯ GalerÃ­a de Logros
      </h3>

      <!-- Achievement Categories -->
      <div class="mb-6">
        <div class="flex flex-wrap gap-2 mb-4">
          <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">
            âœ… Obtenidos: {{ gamificationState?.earned_achievements?.length || 0 }}
          </span>
          <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">
            ğŸ”’ Pendientes: {{ (allAchievements.length - (gamificationState?.earned_achievements?.length || 0)) }}
          </span>
          <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium">
            ğŸ“Š Total: {{ allAchievements.length }}
          </span>
        </div>
      </div>

      <!-- Achievements Grid -->
      <div *ngIf="allAchievements.length > 0; else noAchievements" 
           class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        
        <div *ngFor="let achievement of allAchievements" 
             class="achievement-card relative overflow-hidden"
             [ngClass]="{
               'earned': isAchievementEarned(achievement.id),
               'locked': !isAchievementEarned(achievement.id)
             }">
          
          <!-- Achievement Content -->
          <div class="p-4 h-full flex flex-col">
            <!-- Achievement Icon -->
            <div class="w-16 h-16 mx-auto mb-3 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden"
                 [ngClass]="{
                   'bg-yellow-100': isAchievementEarned(achievement.id),
                   'bg-gray-100': !isAchievementEarned(achievement.id)
                 }">
              <img *ngIf="achievement.icon_url && isAchievementEarned(achievement.id)" 
                   [src]="getAchievementIconUrl(achievement.id)"
                   [alt]="achievement.title"
                   class="w-full h-full object-cover"
                   (error)="$event.target.style.display='none'">
              <span *ngIf="!achievement.icon_url || !isAchievementEarned(achievement.id)" 
                    class="text-2xl"
                    [ngClass]="{
                      'opacity-100': isAchievementEarned(achievement.id),
                      'opacity-30': !isAchievementEarned(achievement.id)
                    }">
                {{ isAchievementEarned(achievement.id) ? 'ğŸ†' : 'ğŸ”’' }}
              </span>
            </div>
            
            <!-- Achievement Details -->
            <div class="text-center flex-1">
              <h4 class="font-semibold text-gray-900 text-sm mb-2"
                  [ngClass]="{
                    'text-gray-900': isAchievementEarned(achievement.id),
                    'text-gray-400': !isAchievementEarned(achievement.id)
                  }">
                {{ achievement.title }}
              </h4>
              <p class="text-xs text-gray-600 mb-3 line-clamp-2"
                 [ngClass]="{
                   'text-gray-600': isAchievementEarned(achievement.id),
                   'text-gray-400': !isAchievementEarned(achievement.id)
                 }">
                {{ achievement.description }}
              </p>
              
              <!-- Points Badge -->
              <div class="inline-block px-2 py-1 rounded-full text-xs font-medium mb-2"
                   [ngClass]="{
                     'bg-yellow-200 text-yellow-800': isAchievementEarned(achievement.id),
                     'bg-gray-200 text-gray-600': !isAchievementEarned(achievement.id)
                   }">
                +{{ achievement.points_reward }} pts
              </div>
              
              <!-- Date Earned -->
              <div *ngIf="isAchievementEarned(achievement.id)" class="text-xs text-gray-500 mt-2">
                {{ formatDate(getEarnedDate(achievement.id)!) }}
              </div>
              
              <!-- Locked State -->
              <div *ngIf="!isAchievementEarned(achievement.id)" class="text-xs text-gray-400 mt-2">
                Por desbloquear
              </div>
            </div>
          </div>
          
          <!-- Earned Badge -->
          <div *ngIf="isAchievementEarned(achievement.id)" 
               class="absolute top-2 right-2 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
            <span class="text-white text-xs">âœ“</span>
          </div>
        </div>
      </div>

      <!-- No Achievements State -->
      <ng-template #noAchievements>
        <div class="text-center py-12">
          <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <span class="text-3xl">ğŸ†</span>
          </div>
          <h4 class="text-lg font-semibold text-gray-900 mb-2">Sistema de logros disponible pronto</h4>
          <p class="text-gray-600 text-sm max-w-xs mx-auto">
            Los logros estÃ¡n siendo configurados. Â¡Vuelve pronto para ver tu progreso!
          </p>
        </div>
      </ng-template>

      <!-- Loading State -->
      <div *ngIf="isLoadingAchievements" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <div *ngFor="let i of [1,2,3,4,5,6]" class="bg-gray-50 rounded-lg p-4 animate-pulse">
          <div class="w-16 h-16 bg-gray-200 rounded-full mx-auto mb-3"></div>
          <div class="h-4 bg-gray-200 rounded w-3/4 mx-auto mb-2"></div>
          <div class="h-3 bg-gray-200 rounded w-full mb-2"></div>
          <div class="h-6 bg-gray-200 rounded w-1/2 mx-auto"></div>
        </div>
      </div>
    </div>

    <!-- Tips Section -->
    <div class="mt-6 bg-blue-50 rounded-xl p-4 border border-blue-200">
      <h4 class="font-semibold text-blue-900 mb-2 flex items-center gap-2">
        ğŸ’¡ Consejos para obtener logros
      </h4>
      <ul class="text-sm text-blue-800 space-y-1">
        <li>â€¢ Participa activamente en grupos para ganar puntos</li>
        <li>â€¢ Crea y Ãºnete a actividades regularmente</li>
        <li>â€¢ Completa actividades para desbloquear logros especiales</li>
        <li>â€¢ Cada logro te otorga puntos que te ayudan a subir de nivel</li>
      </ul>
    </div>
  </main>

  <!-- Bottom Navigation -->
  <app-bottom-nav></app-bottom-nav>
</div>