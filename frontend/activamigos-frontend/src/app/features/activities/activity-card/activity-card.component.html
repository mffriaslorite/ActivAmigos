<div class="bg-white rounded-2xl p-4 border border-gray-100 shadow-sm hover:shadow-md hover:border-blue-200 transition-all duration-200 cursor-pointer group relative overflow-hidden"
     (click)="onCardClick()"
     tabindex="0"
     [attr.aria-label]="'Ver detalles de ' + activity.title">
  
  <div class="flex items-start gap-4">
    
    <div [class]="'w-14 h-14 rounded-2xl flex items-center justify-center flex-shrink-0 text-3xl ' + getIconBackground()">
      {{ getActivityIcon() }}
    </div>
    
    <div class="flex-1 min-w-0">
      
      <div class="flex justify-between items-start">
        <h3 class="font-bold text-gray-900 text-lg leading-tight mb-1 truncate pr-2">
          {{ activity.title }}
        </h3>
      </div>
      
      <p class="text-gray-500 text-xs mb-3 flex items-center gap-3">
        <span class="flex items-center gap-1 bg-gray-50 px-2 py-1 rounded-md">
          ğŸ“… {{ formatDate(activity.date) }}
        </span>
        <span *ngIf="activity.location" class="truncate max-w-[100px]">
          ğŸ“ {{ activity.location }}
        </span>
      </p>

      <div class="flex items-center justify-between mt-2">
        
        <ng-container *ngIf="activity.is_participant; else joinButton">
          <div class="flex items-center gap-2">
            <span *ngIf="getStatusInfo() as status" 
                  [class]="'px-3 py-1 rounded-lg text-xs font-bold border flex items-center gap-1 ' + status.class">
              {{ status.icon }} {{ status.text }}
            </span>
          </div>

          <button (click)="onLeave($event)"
                  [disabled]="isLoading"
                  class="text-xs text-red-400 hover:text-red-600 font-medium px-2 py-1 rounded hover:bg-red-50 transition-colors"
                  title="Darse de baja">
             {{ isLoading ? '...' : 'Salir' }}
          </button>
        </ng-container>

        <ng-template #joinButton>
          <span class="text-xs text-gray-400">
            ğŸ‘¥ {{ activity.participant_count }} apuntados
          </span>
          
          <button (click)="onJoin($event)"
                  [disabled]="isLoading"
                  class="bg-blue-600 text-white text-xs font-bold px-4 py-2 rounded-xl shadow-sm hover:bg-blue-700 active:scale-95 transition-all flex items-center gap-2 disabled:opacity-50">
            <span *ngIf="isLoading" class="w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"></span>
            <span>Apuntarme</span>
          </button>
        </ng-template>

      </div>
    </div>
  </div>
</div>