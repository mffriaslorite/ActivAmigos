<div class="fixed inset-0 bg-gray-300 bg-opacity-20 backdrop-blur-sm flex items-center justify-center z-50" *ngIf="isVisible">
    <div class="bg-white rounded-xl p-6 m-4 w-full max-w-lg max-h-[90vh] overflow-y-auto">
        <!-- Header -->
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-bold text-gray-900">Editar Perfil</h2>
            <button 
                class="text-gray-400 hover:text-gray-600 p-2"
                (click)="closeModal()"
            >
            ‚úï
            </button>
        </div>

        <!-- Profile Image Section -->
        <div class="text-center mb-6">
            <div class="relative inline-block">
                <div class="w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 overflow-hidden">
                    <img 
                        *ngIf="getProfileImageUrl()" 
                        [src]="getProfileImageUrl()" 
                        alt="Profile" 
                        class="w-full h-full object-cover"
                    >
                    <span *ngIf="!getProfileImageUrl()" class="text-3xl">üë§</span>
                </div>
                <button 
                    type="button"
                    class="absolute bottom-0 right-0 bg-blue-600 text-white rounded-full p-2 hover:bg-blue-700 transition-colors"
                    (click)="triggerFileInput()"
                    [disabled]="isUploading"
                >
                    <span *ngIf="!isUploading">üì∑</span>
                    <span *ngIf="isUploading" class="inline-block animate-spin">‚è≥</span>
                </button>
            </div>
            <input 
                #fileInput
                type="file" 
                class="hidden" 
                accept="image/*"
                (change)="onImageSelected($event)"
            >
            <p class="text-sm text-gray-500 mt-2">
                {{ isUploading ? 'Subiendo imagen...' : 'Haz clic en el √≠cono de c√°mara para cambiar la foto' }}
            </p>
            <div class="mt-2" *ngIf="getProfileImageUrl()">
                <button
                    type="button"
                    class="mt-2 text-sm text-red-600 hover:text-red-700 disabled:opacity-50 disabled:cursor-not-allowed"
                    (click)="onDeleteImage()"
                    [disabled]="isUploading || isLoading || !getProfileImageUrl()"
                >
                    Eliminar foto de perfil
                </button>
            </div>
        </div>

        <!-- Edit Form -->
        <form [formGroup]="profileForm" (ngSubmit)="onSubmit()">
            <!-- First Name -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    Nombre
                </label>
                <input
                    type="text"
                    formControlName="first_name"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Tu nombre"
                >
                <div *ngIf="profileForm.get('first_name')?.invalid && profileForm.get('first_name')?.touched" 
                        class="text-red-500 text-xs mt-1">
                    El nombre es requerido y debe tener al menos 2 caracteres
                </div>
            </div>

            <!-- Last Name -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    Apellido
                </label>
                <input
                    type="text"
                    formControlName="last_name"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Tu apellido"
                >
                <div *ngIf="profileForm.get('last_name')?.invalid && profileForm.get('last_name')?.touched" 
                        class="text-red-500 text-xs mt-1">
                    El apellido es requerido y debe tener al menos 2 caracteres
                </div>
            </div>

            <!-- Bio -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    Biograf√≠a
                </label>
                <textarea
                    formControlName="bio"
                    rows="3"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Cu√©ntanos algo sobre ti..."
                    maxlength="500"
                ></textarea>
                <div class="text-xs text-gray-500 mt-1">
                    {{ profileForm.get('bio')?.value?.length || 0 }}/500 caracteres
                </div>
                <div *ngIf="profileForm.get('bio')?.invalid && profileForm.get('bio')?.touched" 
                        class="text-red-500 text-xs mt-1">
                    La biograf√≠a no puede exceder 500 caracteres
                </div>
            </div>

            <!-- Error/Success Messages -->
            <div *ngIf="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                {{ errorMessage }}
            </div>
            <div *ngIf="successMessage" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
                {{ successMessage }}
            </div>

            <!-- Action Buttons -->
            <div class="flex space-x-3">
                <button
                    type="button"
                    class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"
                    (click)="closeModal()"
                    [disabled]="isLoading || isUploading"
                >
                    Cancelar
                </button>
                <button
                    type="submit"
                    class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50"
                    [disabled]="isLoading || isUploading || profileForm.invalid"
                    [attr.aria-busy]="isLoading"
                >
                    <span *ngIf="!isLoading">Guardar Cambios</span>
                    <span *ngIf="isLoading" class="inline-flex items-center">
                        <span class="animate-spin mr-2">‚è≥</span> Guardando...
                    </span>
                </button>
            </div>
        </form>
    </div>
</div>

