<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" *ngIf="isVisible">
    <div class="bg-white rounded-xl p-6 m-4 w-full max-w-md">
        <!-- Header -->
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-bold text-gray-900">Cambiar ContraseÃ±a</h2>
            <button 
            class="text-gray-400 hover:text-gray-600 p-2"
            (click)="closeModal()"
            >
            âœ•
            </button>
        </div>

        <!-- Password Change Form -->
        <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
            <!-- Current Password -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    ContraseÃ±a Actual
                </label>
                <div class="relative">
                    <input
                    [type]="showCurrentPassword ? 'text' : 'password'"
                    formControlName="current_password"
                    class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Tu contraseÃ±a actual"
                    >
                    <button
                    type="button"
                    class="absolute inset-y-0 right-0 px-3 flex items-center"
                    (click)="showCurrentPassword = !showCurrentPassword"
                    >
                    {{ showCurrentPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
                    </button>
                </div>
                <div *ngIf="passwordForm.get('current_password')?.invalid && passwordForm.get('current_password')?.touched" 
                        class="text-red-500 text-xs mt-1">
                    La contraseÃ±a actual es requerida
                </div>
            </div>

            <!-- New Password -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    Nueva ContraseÃ±a
                </label>
                <div class="relative">
                    <input
                        [type]="showNewPassword ? 'text' : 'password'"
                        formControlName="new_password"
                        class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Tu nueva contraseÃ±a"
                    >
                    <button
                        type="button"
                        class="absolute inset-y-0 right-0 px-3 flex items-center"
                        (click)="showNewPassword = !showNewPassword"
                    >
                    {{ showNewPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
                    </button>
                </div>
                <div *ngIf="passwordForm.get('new_password')?.invalid && passwordForm.get('new_password')?.touched" 
                        class="text-red-500 text-xs mt-1">
                    La nueva contraseÃ±a debe tener al menos 8 caracteres
                </div>
            </div>

            <!-- Confirm New Password -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    Confirmar Nueva ContraseÃ±a
                </label>
                <div class="relative">
                    <input
                        [type]="showConfirmPassword ? 'text' : 'password'"
                        formControlName="confirm_password"
                        class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Confirma tu nueva contraseÃ±a"
                    >
                    <button
                        type="button"
                        class="absolute inset-y-0 right-0 px-3 flex items-center"
                        (click)="showConfirmPassword = !showConfirmPassword"
                    >
                        {{ showConfirmPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
                    </button>
                </div>
                <div *ngIf="passwordForm.get('confirm_password')?.invalid && passwordForm.get('confirm_password')?.touched" 
                        class="text-red-500 text-xs mt-1">
                    Las contraseÃ±as no coinciden
                </div>
            </div>

            <!-- Password Requirements -->
            <div class="mb-4 p-3 bg-blue-50 rounded-md">
                <h4 class="text-sm font-medium text-blue-900 mb-2">Requisitos de la contraseÃ±a:</h4>
                <ul class="text-xs text-blue-700 space-y-1">
                    <li class="flex items-center">
                    <span class="mr-2">{{ getPasswordStrength().length ? 'âœ…' : 'âŒ' }}</span>
                        Al menos 8 caracteres
                    </li>
                    <li class="flex items-center">
                    <span class="mr-2">{{ getPasswordStrength().hasUpperCase ? 'âœ…' : 'âŒ' }}</span>
                        Una letra mayÃºscula
                    </li>
                    <li class="flex items-center">
                    <span class="mr-2">{{ getPasswordStrength().hasLowerCase ? 'âœ…' : 'âŒ' }}</span>
                        Una letra minÃºscula
                    </li>
                    <li class="flex items-center">
                    <span class="mr-2">{{ getPasswordStrength().hasNumber ? 'âœ…' : 'âŒ' }}</span>
                        Un nÃºmero
                    </li>
                </ul>
            </div>

            <!-- Error/Success Messages -->
            <div *ngIf="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                {{ errorMessage }}
            </div>
            <div *ngIf="successMessage" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
                {{ successMessage }}
            </div>

            <!-- Action Buttons -->
            <div class="flex space-x-3">
                <button
                    type="button"
                    class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"
                    (click)="closeModal()"
                >
                    Cancelar
                </button>
                <button
                    type="submit"
                    class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50"
                    [disabled]="isLoading || passwordForm.invalid"
                >
                    {{ isLoading ? 'Cambiando...' : 'Cambiar ContraseÃ±a' }}
                </button>
            </div>
        </form>
    </div>
</div>