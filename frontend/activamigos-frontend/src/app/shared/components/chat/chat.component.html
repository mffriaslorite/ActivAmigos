<!-- Chat Container -->
<div class="flex flex-col h-full bg-white rounded-lg shadow-sm border border-gray-200">
  <!-- Chat Header -->
  <div class="flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50 rounded-t-lg">
    <div class="flex items-center space-x-3">
      <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
        <span class="text-sm font-medium text-blue-600">
          {{ chatRoom.type === 'group' ? 'ğŸ‘¥' : 'ğŸ¯' }}
        </span>
      </div>
      <div>
        <h3 class="text-lg font-semibold text-gray-900">Chat</h3>
        <p class="text-sm text-gray-500">{{ chatRoom.name }}</p>
      </div>
    </div>
    
    <!-- Connection Status -->
    <div class="flex items-center space-x-2">
      <div 
        class="w-2 h-2 rounded-full"
        [class]="isConnected ? 'bg-green-500' : 'bg-red-500'"
      ></div>
      <span class="text-xs text-gray-500">
        {{ isConnected ? 'Conectado' : 'Desconectado' }}
      </span>
    </div>
  </div>

  <!-- Messages Container -->
  <div 
    #messageContainer
    class="flex-1 overflow-y-auto p-4 space-y-4 min-h-0"
    style="max-height: 400px;"
  >
    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex justify-center items-center py-8">
      <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
      <span class="ml-2 text-gray-500">Cargando mensajes...</span>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && messages.length === 0" class="text-center py-8 text-gray-500">
      <div class="text-4xl mb-2">ğŸ’¬</div>
      <p class="text-lg font-medium">No hay mensajes aÃºn</p>
      <p class="text-sm">Â¡SÃ© el primero en enviar un mensaje!</p>
    </div>

    <!-- Messages -->
    <div *ngFor="let message of messages" class="flex" [class.justify-end]="isOwnMessage(message)">
      <div 
        class="max-w-xs lg:max-w-md px-4 py-2 rounded-lg"
        [class]="isOwnMessage(message) 
          ? 'bg-blue-500 text-white rounded-br-none' 
          : 'bg-gray-100 text-gray-900 rounded-bl-none'"
      >
        <!-- Sender Info (for others' messages) -->
        <div *ngIf="!isOwnMessage(message)" class="flex items-center space-x-2 mb-1">
          <div class="w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center">
            <span class="text-xs font-medium text-blue-600">
              {{ getMessageInitials(message) }}
            </span>
          </div>
          <span class="text-xs font-medium" [class]="isOwnMessage(message) ? 'text-blue-100' : 'text-gray-600'">
            {{ getMessageDisplayName(message) }}
          </span>
        </div>

        <!-- Message Content -->
        <p class="text-sm whitespace-pre-wrap break-words">{{ message.content }}</p>

        <!-- Timestamp -->
        <p 
          class="text-xs mt-1"
          [class]="isOwnMessage(message) ? 'text-blue-100' : 'text-gray-500'"
          [title]="formatFullMessageTime(message.timestamp)"
        >
          {{ formatMessageTime(message.timestamp) }}
        </p>
      </div>
    </div>
  </div>

  <!-- Message Input -->
  <div class="p-4 border-t border-gray-200 bg-gray-50 rounded-b-lg">
    <div class="flex space-x-2">
      <input
        [(ngModel)]="newMessage"
        (keypress)="onKeyPress($event)"
        placeholder="Escribe un mensaje..."
        class="flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        [disabled]="!isConnected"
        maxlength="2000"
      />
      
      <button
        (click)="sendMessage()"
        [disabled]="!newMessage.trim() || !isConnected"
        class="px-6 py-2 bg-blue-500 text-white rounded-full hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
      >
        <span class="text-sm font-medium">Enviar</span>
      </button>
    </div>
    
    <!-- Character Counter -->
    <div class="flex justify-between items-center mt-2 text-xs text-gray-500">
      <span *ngIf="!isConnected" class="text-red-500">
        âš ï¸ No conectado - Los mensajes no se enviarÃ¡n
      </span>
      <span *ngIf="isConnected" class="text-green-600">
        âœ… Conectado y listo
      </span>
      <span>{{ newMessage.length }}/2000</span>
    </div>
  </div>
</div>